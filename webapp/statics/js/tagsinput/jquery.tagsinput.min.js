(function(C){var B=new Array();var A=new Array();C.fn.doAutosize=function(I){var G=C(this).data("minwidth"),J=C(this).data("maxwidth"),H="",L=C(this),M=C("#"+C(this).data("tester_id"));if(H===(H=L.val())){return}var K=H.replace(/&/g,"&amp;").replace(/\s/g," ").replace(/</g,"&lt;").replace(/>/g,"&gt;");M.html(K);var D=M.width(),N=(D+I.comfortZone)>=G?D+I.comfortZone:G,F=L.width(),E=(N<F&&N>=G)||(N>G&&N<J);if(E){L.width(N)}};C.fn.resetAutosize=function(F){var D=C(this).data("minwidth")||F.minInputWidth||C(this).width(),H=C(this).data("maxwidth")||F.maxInputWidth||(C(this).closest(".tagsinput").width()-F.inputPadding),I="",G=C(this),J=C("<tester/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:G.css("fontSize"),fontFamily:G.css("fontFamily"),fontWeight:G.css("fontWeight"),letterSpacing:G.css("letterSpacing"),whiteSpace:"nowrap"}),E=C(this).attr("id")+"_autosize_tester";if(!C("#"+E).length>0){J.attr("id",E);J.appendTo("body")}G.data("minwidth",D);G.data("maxwidth",H);G.data("tester_id",E);G.css("width",D)};C.fn.addTag=function(E,D){D=jQuery.extend({focus:false,callback:true},D);this.each(function(){var J=C(this).attr("id");var H=C(this).val().split(B[J]);if(H[0]==""){H=new Array()}E=jQuery.trim(E);if(D.unique){var F=C(this).tagExist(E);if(F==true){C("#"+J+"_tag").addClass("not_valid")}}else{var F=false}if(E!=""&&F!=true){C("<span>").addClass("tag").append(C("<span>").text(E).append("&nbsp;&nbsp;"),C("<a>",{href:"#",title:"Removing tag",text:"x"}).click(function(){return C("#"+J).removeTag(escape(E))})).insertBefore("#"+J+"_addTag");H.push(E);C("#"+J+"_tag").val("");if(D.focus){C("#"+J+"_tag").focus()}else{C("#"+J+"_tag").blur()}C.fn.tagsInput.updateTagsField(this,H);if(D.callback&&A[J]&&A[J]["onAddTag"]){var I=A[J]["onAddTag"];I.call(this,E)}if(A[J]&&A[J]["onChange"]){var G=H.length;var I=A[J]["onChange"];I.call(this,C(this),H[G-1])}}});return false};C.fn.removeTag=function(D){D=unescape(D);this.each(function(){var H=C(this).attr("id");var G=C(this).val().split(B[H]);if(A[H]&&A[H]["beforeRemove"]){var E=A[H]["beforeRemove"];var F=E.call(this,D);if(F){return false}}C("#"+H+"_tagsinput .tag").remove();str="";for(i=0;i<G.length;i++){if(G[i]!=D){str=str+B[H]+G[i]}}C.fn.tagsInput.importTags(this,str);if(A[H]&&A[H]["onRemoveTag"]){var E=A[H]["onRemoveTag"];E.call(this,D)}});return false};C.fn.tagExist=function(E){var F=C(this).attr("id");var D=C(this).val().split(B[F]);return(jQuery.inArray(E,D)>=0)};C.fn.importTags=function(D){id=C(this).attr("id");C("#"+id+"_tagsinput .tag").remove();C.fn.tagsInput.importTags(this,D)};C.fn.tagsInput=function(D){var E=jQuery.extend({interactive:true,defaultText:"add a tag",minChars:0,width:"300px",height:"100px",autocomplete:{selectFirst:false},"hide":true,"delimiter":",","unique":true,removeWithBackspace:true,placeholderColor:"#666666",autosize:true,comfortZone:20,inputPadding:6*2},D);this.each(function(){if(E.hide){C(this).hide()}var H=C(this).attr("id");if(!H||B[C(this).attr("id")]){H=C(this).attr("id","tags"+new Date().getTime()).attr("id")}var F=jQuery.extend({pid:H,real_input:"#"+H,holder:"#"+H+"_tagsinput",input_wrapper:"#"+H+"_addTag",fake_input:"#"+H+"_tag"},E);B[H]=F.delimiter;if(E.onAddTag||E.onRemoveTag||E.onChange||E.beforeRemove){A[H]=new Array();A[H]["onAddTag"]=E.onAddTag;A[H]["onRemoveTag"]=E.onRemoveTag;A[H]["onChange"]=E.onChange;A[H]["beforeRemove"]=E.beforeRemove}var G='<div id="'+H+'_tagsinput" class="tagsinput"><div id="'+H+'_addTag">';if(E.interactive){G=G+'<input id="'+H+'_tag" value="" data-default="'+E.defaultText+'" />'}G=G+'</div><div class="tags_clear"></div></div>';C(G).insertAfter(this);C(F.holder).css("width",E.width);C(F.holder).css("min-height",E.height);C(F.holder).css("height","100%");if(C(F.real_input).val()!=""){C.fn.tagsInput.importTags(C(F.real_input),C(F.real_input).val())}if(E.interactive){C(F.fake_input).val(C(F.fake_input).attr("data-default"));C(F.fake_input).css("color",E.placeholderColor);C(F.fake_input).resetAutosize(E);C(F.holder).bind("click",F,function(I){C(I.data.fake_input).focus()});C(F.fake_input).bind("focus",F,function(I){if(C(I.data.fake_input).val()==C(I.data.fake_input).attr("data-default")){C(I.data.fake_input).val("")}C(I.data.fake_input).css("color","#000000")});if(E.autocomplete_url!=undefined){autocomplete_options={source:E.autocomplete_url};for(attrname in E.autocomplete){autocomplete_options[attrname]=E.autocomplete[attrname]}if(jQuery.Autocompleter!==undefined){C(F.fake_input).autocomplete(E.autocomplete_url,E.autocomplete);C(F.fake_input).bind("result",F,function(J,K,I){if(K){C("#"+H).addTag(K[0]+"",{focus:true,unique:(E.unique)})}})}else{if(jQuery.ui.autocomplete!==undefined){C(F.fake_input).autocomplete(autocomplete_options);C(F.fake_input).bind("autocompleteselect",F,function(J,I){C(J.data.real_input).addTag(I.item.value,{focus:true,unique:(E.unique)});return false})}}}else{C(F.fake_input).bind("blur",F,function(J){var I=C(this).attr("data-default");if(C(J.data.fake_input).val()!=""&&C(J.data.fake_input).val()!=I){if((J.data.minChars<=C(J.data.fake_input).val().length)&&(!J.data.maxChars||(J.data.maxChars>=C(J.data.fake_input).val().length))){C(J.data.real_input).addTag(C(J.data.fake_input).val(),{focus:true,unique:(E.unique)})}}else{C(J.data.fake_input).val(C(J.data.fake_input).attr("data-default"));C(J.data.fake_input).css("color",E.placeholderColor)}return false})}C(F.fake_input).bind("keypress",F,function(I){if(I.which==I.data.delimiter.charCodeAt(0)||I.which==13){I.preventDefault();if((I.data.minChars<=C(I.data.fake_input).val().length)&&(!I.data.maxChars||(I.data.maxChars>=C(I.data.fake_input).val().length))){C(I.data.real_input).addTag(C(I.data.fake_input).val(),{focus:true,unique:(E.unique)})}C(I.data.fake_input).resetAutosize(E);return false}else{if(I.data.autosize){C(I.data.fake_input).doAutosize(E)}}});F.removeWithBackspace&&C(F.fake_input).bind("keydown",function(I){if(I.keyCode==8&&C(this).val()==""){I.preventDefault();var J=C(this).closest(".tagsinput").find(".tag:last").text();var K=C(this).attr("id").replace(/_tag$/,"");J=J.replace(/[\s]+x$/,"");C("#"+K).removeTag(escape(J));C(this).trigger("focus")}});C(F.fake_input).blur();if(F.unique){C(F.fake_input).keydown(function(I){if(I.keyCode==8||String.fromCharCode(I.which).match(/\w+|[áéíóúÁÉÍÓÚñÑ,/]+/)){C(this).removeClass("not_valid")}})}}});return this};C.fn.tagsInput.updateTagsField=function(D,E){var F=C(D).attr("id");C(D).val(E.join(B[F]))};C.fn.tagsInput.importTags=function(E,G){C(E).val("");var H=C(E).attr("id");var D=G.split(B[H]);for(i=0;i<D.length;i++){C(E).addTag(D[i],{focus:false,callback:false})}if(A[H]&&A[H]["onChange"]){var F=A[H]["onChange"];F.call(E,E,D[i])}}})(jQuery);